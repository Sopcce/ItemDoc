
@{
    ViewBag.Title = "Catalog";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<link href="~/Scripts/bootstrap-treeview/css/bootstrap-treeview.css" rel="stylesheet" />
<script src="~/Scripts/bootstrap-treeview/js/bootstrap-treeview.js"></script>
<style>
    .casd {
        height: 230px;
        overflow-y: auto;
        overflow-x: hidden;
    }
</style>
@Html.Partial("_CommonHead")
<div class="row">

    <input type="text" id="hf-tree-checkedvalue" style="width: 580px;" />
    <div class="col-sm-4">
        <form class="form-inline">
            <div class="form-group">
                <input type="text" class="form-control" id="input-search" placeholder="Search">
            </div>
            <div class="btn-group">
                <button type="button" class="btn btn-danger" id="btn-search">Search</button>
                <button type="button" class="btn btn-danger dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="caret"></span>
                    <span class="sr-only">Toggle Dropdown</span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="#" id="btn-clear-search">Clear</a></li>
                    <li><a href="#" id="btn-edit">编辑</a></li>
                    <li><a href="#" id="btn-delete">删除</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="#" data-status="true" id="btn-disable-all">禁用</a></li>
                    <li><a href="#" data-status="true" id="btn-check-all">全选</a></li>
                    <li><a href="#" data-status="false" id="btn-expand-all">收缩</a></li>

                </ul>
            </div>
        </form>
        <hr />
        <div id="treeview7" data-checkedvalue="," class=""></div>
    </div>
    <div class="col-sm-8 sop-red" style="min-height: 400px;">
        <div class="btn-group pull-right sop-red">

            <a class="btn btn-link" href="https://github.com/Sopcce/ItemDoc/issues" target="_blank">分享</a>
            <a class="btn btn-link dropdown-toggle" data-toggle="dropdown" href="#" aria-expanded="false">
                更多 <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                <li><a href="#">复制</a></li>
                <li><a href="#">删除</a></li>
            </ul>
        </div>
        <div style="height: 400px">
            123123 

        </div>

    </div>
</div>




<script src="~/Scripts/layer/layer.js"></script>

<script type="text/javascript">
    $(function () {

        $.post("/Item/TreeView",
            { name: '1' },
            function (data) {

                TreeView(data);
            },
            "json");

    });

    function TreeView(data) {
        var $tree = $('#treeview7').treeview({
            color: "#428bca",
            levels: 99,
            expandIcon: 'glyphicon glyphicon-chevron-right',
            collapseIcon: 'glyphicon glyphicon-chevron-down',
            nodeIcon: "glyphicon glyphicon-user",
            showTags: false,
            showBorder: true,
            enableLinks: true,
            showIcon: true,
            showCheckbox: true,
            data: data,
            multiSelect: false,
            onNodeSelected: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeSelected</p>');
            },
            onNodeChecked: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeChecked</p>');
                //console.log('<p>' + node.nodeId + ' was onNodeChecked</p>');
                if ($("#hf-tree-checkedvalue")) {
                    var value = $("#hf-tree-checkedvalue").val();
                    if (value === "") {
                        value = "," + node.nodeId + ",";
                    } else {
                        if (value.toString().indexOf(node.nodeId) == -1) {
                            value = value + node.nodeId + ",";
                        }
                    }
                    $("#hf-tree-checkedvalue").val(value);
                    console.log(value);
                }

                layer.msg("asd");

            },
            onNodeUnchecked: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeUnchecked</p>');
                if ($("#hf-tree-checkedvalue")) {
                    var value = $("#hf-tree-checkedvalue").val();
                    if (value !== "") {
                        var reg = "";
                        if (value.toString().indexOf("," + node.nodeId + ",") != -1) {
                            reg = "," + node.nodeId + ",";
                        }
                        value = value.toString().replace(reg, ',');
                    }
                    $("#hf-tree-checkedvalue").val(value);
                    console.log(value);
                }
            },
            onNodeDisabled: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeDisabled</p>');
            },
            onNodeEnabled: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeEnabled</p>');
            },
            onNodeCollapsed: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeCollapsed</p>');
            },

            onNodeUnselected: function (event, node) {
                console.log('<p>' + node.text + ' was onNodeUnselected</p>');
            }
        });
        var silent1 = false;
        //启用禁用
        $('#btn-disable-all').on('click', function (e) {
            var $this = this;
            var status = $this.attributes["data-status"].value;
            console.log(status);
            if (status == "true") {
                $this.attributes["data-status"].value = false;
                $this.innerText = "启用";
                $tree.treeview('disableAll', { silent: silent1 });
            }
            if (status == "false") {
                $this.attributes["data-status"].value = true;
                $this.innerText = "禁用";
                $tree.treeview('enableAll', { silent: silent1 });
            }


        });

        $('#btn-check-all').on('click', function (e) {
            var $this = this;
            var status = $this.attributes["data-status"].value;
            console.log(status);
            if (status == "true") {
                $this.attributes["data-status"].value = false;
                $this.innerText = "取消";
                $tree.treeview('checkAll', { silent: silent1 });
            }
            if (status == "false") {
                $this.attributes["data-status"].value = true;
                $this.innerText = "全选";
                $tree.treeview('uncheckAll', { silent: silent1 });
            }


        });

        $('#btn-expand-all').on('click', function (e) {
            var $this = this;
            var status = $this.attributes["data-status"].value;
            console.log(status);
            if (status == "true") {
                $this.attributes["data-status"].value = false;
                $this.innerText = "收缩";

                $tree.treeview('expandAll', { silent: silent1 });
            }
            if (status == "false") {
                $this.attributes["data-status"].value = true;
                $this.innerText = "展开";

                $tree.treeview('collapseAll', { silent: silent1 });
            }


        });

        var results = function () {
            var pattern = $('#input-search').val();
            var options = {
                ignoreCase: true,
                exactMatch: false,
                revealResults: true
            };
            return $tree.treeview('search', [pattern, options]);
        }
        var search = function (e) {
            results();
            var output = '<p>' + results.length + ' matches found</p>';
            $.each(results, function (index, result) {
                output += '<p>- ' + result.text + '</p>';
            });
            console.log(output);
            //$tree.treeview('selectNode', [results(), { silent: silent1 }]);

        }

        $('#btn-search').on('click', search);
        $('#input-search').on('keyup', search);

        $('#btn-clear-search').on('click', function (e) {
            $tree.treeview('clearSearch');
            //$tree.treeview('toggleNodeSelected', [results(), { silent: silent1 }]);
            //$tree.treeview('unselectNode', [results(), { silent: silent1 }]);
            $('#input-search').val('');

        });

        $('#btn-delete').on('click', function (e) {
            var value = $("#hf-tree-checkedvalue").val();
            console.log(value);
            layer.msg(value);
        });



    }



</script>
